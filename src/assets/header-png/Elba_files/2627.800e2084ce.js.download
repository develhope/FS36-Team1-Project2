__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n,c){const p=(0,s.default)(),v=(0,o.useNaviInternalContext)();return(0,t.useEffect)((()=>(p((()=>`Creating scope "${n}"`)),v.addScope(n,c),()=>{p((()=>`Unmounting scope "${n}" and cleaning up`)),v.removeScope(n)})),[n]),(0,t.useEffect)((()=>{v.updateScopeDependencies(n,c)}),[n,c]),u(n)},e.useExistingScope=void 0;var t=r(d[1]),o=r(d[2]),s=n(r(d[3]));function u(n){const s=(0,o.useNaviInternalContext)();return(0,t.useMemo)((()=>({registerPresenter:t=>s.registerPresenter(t,n),removePresenter:t=>s.removePresenter(t,n),scheduleAnnouncement:t=>s.scheduleAnnouncement(t,n),scheduleAnnouncements:t=>s.scheduleAnnouncements(t,n),removeAnnouncement:t=>s.removeAnnouncement(t,n),startPresentation:()=>s.startPresentation(n),reset:()=>s.resetScope(n),remove:()=>s.removeScope(n)})),[n])}e.useExistingScope=u}),"014366",["ba7a76","07aa1f","7b3437","c809cd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.getAnnouncementId=e.getAnnouncement=e.default=e.coerceToFutureAnnouncement=e.FutureAnnouncementSingleDevice=void 0;var t=n(r(d[1])),c=n(r(d[2]));class u extends c.default{constructor(...n){super(...n),this.announcement=void 0,this.timer=void 0}ready(n){n&&(this.announcement.content=n),super.resolve(this.announcement),this.clearTimeout()}cancel(){super.reject(),this.clearTimeout()}startTimeout(){}clearTimeout(){this.timer&&clearTimeout(this.timer)}}class o extends u{constructor(n){super(),this.announcement=new t.default.SingleDevice(n)}}e.FutureAnnouncementSingleDevice=o;class s extends u{constructor(n){super(),this.announcement=new t.default(n)}}e.default=s,s.SingleDevice=o;e.coerceToFutureAnnouncement=n=>{if(n instanceof s||n instanceof o)return n;const c=n instanceof t.default?new s(n):new s.SingleDevice(n);return c.ready(),c};const l=n=>n instanceof s||n instanceof o?n.announcement:n;e.getAnnouncement=l;e.getAnnouncementId=n=>l(n).id}),"068775",["ba7a76","f4362a","0af475"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(){this.promise=void 0,this.isFulfilled=!1,this.promiseResolve=void 0,this.promiseReject=void 0,this.isFulfilled=!1,this.promise=new Promise(((s,t)=>{this.promiseResolve=s,this.promiseReject=t}))}resolve(s){return this.isFulfilled||(this.isFulfilled=!0,this.promiseResolve(s)),this}reject(s){return this.catch((()=>{})),this.promiseReject(s),this}then(...s){return this.promise.then(...s)}catch(s){return this.promise.catch(s)}}}),"0af475",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isCanvasAnnouncementEnabled=e.default=e.CANVAS_PREVIEW_ANNOUNCEMENT_ID=void 0;var t=r(d[1]),u=n(r(d[2])),N=n(r(d[3]));const _=e.CANVAS_PREVIEW_ANNOUNCEMENT_ID='CANVAS_PREVIEW_ANNOUNCEMENT_ID';e.isCanvasAnnouncementEnabled=()=>t.Flagger.isTrebuchetLaunched((0,u.default)('canvas.announcements'));const E=new N.default(((n,t)=>n===_||'MCPAnnouncementMicroMegaContent'===t?.__typename));e.default=E}),"0dd5ca",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isEqualSet=void 0;e.isEqualSet=(s,t)=>s.size===t.size&&[...s].every((s=>t.has(s)))}),"1a5f67",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var _=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.HOST_TOS_ANNOUNCEMENT_ID=void 0;var N=_(r(d[1]));const t=e.HOST_TOS_ANNOUNCEMENT_ID='HOST_TOS_ANNOUNCEMENT_ID',O=new N.default(t);e.default=O}),"20f028",["ba7a76","cee790"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,P.default)(),b=(0,s().useNiobeMinimalistClient)(),[R]=(0,s().useMinimalistMutation)(h.default),U=(0,t.useRef)(new Map),$=(0,t.useRef)(new Map),x=n=>n.expirationUtcDateTime&&new Date(n.expirationUtcDateTime)<new Date,H=(0,t.useCallback)((t=>{const o=C(t),c=$.current.get(o);if(c&&!x(c))return c;const s=(0,u.localStorageGetItem)(I()),l=s?.[o];return n((()=>s&&l?[`Local storage cache found for ${o}`,l]:[`No local storage cache found for ${o}`])),l&&!x(l)?l:null}),[]),k=(0,t.useCallback)(((t,o)=>{const c=C(t);$.current.set(c,o);const s=I(),l=(0,u.localStorageGetItem)(s)||{};l[c]=o,n((()=>[`Update local storage cache for ${c}`,l[c]])),(0,u.localStorageSetItem)(s,l,{expires:O})}),[]),E=(0,t.useCallback)(((n,t)=>{const o=H(n);k(n,{impressionCount:(o?.impressionCount||0)+1,createdAtUtcDateTime:(new Date).toISOString(),expirationUtcDateTime:t})}),[]),L=(0,t.useCallback)((async n=>{const t=await b.query({query:p.default,variables:{impressionId:n.id,discriminator:n.discriminator}}),o=t?.data?.viewer?.naviAnnouncementImpressionInfo;if(!o)throw U.current.delete(C(n)),new Error('No impression data returned from server');return o}),[]),T=(0,t.useCallback)((n=>{const t=C(n),o=U.current.get(t);if(o)return o;const c=L(n);return U.current.set(t,c),c}),[]),W=n=>{const t=_(n.id);return t||(n.impressionPolicy?.forceDiscard?w.AnnouncementShowState.DROP:n.impressionPolicy?.forceShow?w.AnnouncementShowState.SHOW:'maxCap'in n.impressionPolicy?void 0:w.AnnouncementShowState.SHOW)},N=(n,t)=>'maxCap'in n.impressionPolicy&&t.impressionCount>=n.impressionPolicy?.maxCap,M=(0,t.useCallback)((async t=>{const o=W(t);if(o)return o;const c=H(t);if(c&&N(t,c))return n((()=>[`Dropping ${t.id} (cache)`,c])),w.AnnouncementShowState.DROP;if(t instanceof A.SingleDeviceAnnouncement||!f.default.isLoggedIn())return t.impressionPolicy instanceof D.AlwaysShowPolicy||(0,S.getConsentForTool)('Airbnb Functional')||t.noConsentBehavior===w.NoConsentBehavior.SHOW?w.AnnouncementShowState.SHOW:w.AnnouncementShowState.DROP;let s;try{s=await T(t)}catch(o){return n((()=>[`Error fetching ${t.id}:`,o])),t.choreographyInfo.priority===w.Priority.POISON_PILL||t.choreographyInfo.priority===w.Priority.LEGAL?w.AnnouncementShowState.SHOW:w.AnnouncementShowState.DROP}return n((()=>[`Updating cache ${t.id} with fresh`,s])),k(t,s),N(t,s)?(n((()=>[`Dropping ${t.id} (server)`,s])),w.AnnouncementShowState.DROP):w.AnnouncementShowState.SHOW}),[]),q=(0,t.useCallback)((t=>{const o=(0,v.getAnnouncement)(t);if(W(o))return;const c=H(o);c&&N(o,c)||o instanceof A.SingleDeviceAnnouncement||f.default.isLoggedIn()&&(n((()=>`Starting impression request for ${o.id}`)),T(o).catch((()=>{})))}),[]),j=(0,t.useCallback)((async t=>{const{id:s,discriminator:u,campaignEndUtcDateTime:S,impressionPolicy:p}=t;n((()=>`Recording impression for ${s}`));let h=null;if('impressionExpirationUtcDateTime'in p&&(h=p.impressionExpirationUtcDateTime),E(t,h),l.default.logJitneyEvent({schema:c().UniversalComponentImpressionEvent,event_data:{uuid:(0,o().v4)(),logging_id:(0,y.jitneyId)(t),component:(0,y.jitneyId)(t),ancestor_uuids:[],ancestor_logging_ids:[]}}),t instanceof A.SingleDeviceAnnouncement)return;if(!f.default.isLoggedIn())return;const w=await R({variables:{impressionId:s,discriminator:u,uuid:(0,o().v4)(),impressionExpirationUtcDateTime:h||S}});'NaviAnnouncementImpressionInfo'===w.data?.recordNaviAnnouncementView?.__typename&&k(t,w.data.recordNaviAnnouncementView)}),[]),G=(0,t.useCallback)((()=>{U.current.clear()}),[]);return(0,t.useMemo)((()=>({startImpressionRequest:q,shouldShowAnnouncement:M,recordImpression:j,clearRequestCache:G})),[])};var t=r(d[1]);function o(){const n=r(d[2]);return o=function(){return n},n}function c(){const n=r(d[3]);return c=function(){return n},n}function s(){const n=r(d[4]);return s=function(){return n},n}var u=r(d[5]),l=n(r(d[6])),f=n(r(d[7])),S=r(d[8]),p=n(r(d[9])),h=n(r(d[10])),w=r(d[11]),v=r(d[12]),A=r(d[13]),y=r(d[14]),D=r(d[15]),P=n(r(d[16]));const O=31536e6;function I(){return`navi_announcements_impressions_${f.default.current().idStr||'logged_out'}`}const C=({id:n,discriminator:t})=>t?`${n}_${t}`:n,_=n=>{{const t=new URL(document.location.href).searchParams,o=t.get('naviDebugPolicies'),c=t.get('naviOnlyShow');if(t.get('naviHideAll'))return w.AnnouncementShowState.DROP;if(c)return n===c?w.AnnouncementShowState.SHOW:w.AnnouncementShowState.DROP;if(o){const t=o.split(',').map((n=>n.split(':'))).find((([t])=>t===n))?.[1];if('SHOW'===t)return w.AnnouncementShowState.SHOW;if('DROP'===t)return w.AnnouncementShowState.DROP}}}}),"2b4782",["ba7a76","07aa1f","305dd5","60aeb4","068abc","13babd","c8b97a","06a99e","8b1591","a6a446","386890","af724a","068775","f4362a","a8aa8f","fc4d8f","c809cd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,f.default)(s.GLOBAL_SCOPE_ID),{loading:t,announcements:h}=(0,_.default)({variables:{appTarget:s.AppTarget.EXPERIENCE_HOST},skip:!l.Flagger.isTrebuchetLaunched((0,o.default)('web.navi_server_announcements.exp_host'))});return(0,u.useEffect)((()=>{!t&&h.length&&n.scheduleAnnouncements(h),(0,p.isUserConsentEnabled)()&&(n.registerPresenter(p.default),n.scheduleAnnouncement(new c.default.SingleDevice({id:p.USER_CONSENT_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new E.AlwaysShowPolicy,choreographyInfo:{priority:s.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:1}}}))),t||n.startPresentation()}),[t,h]),null};var u=r(d[2]),l=r(d[3]),o=t(r(d[4])),s=r(d[5]),c=t(r(d[6])),f=t(r(d[7])),_=t(r(d[8])),p=n(r(d[9])),E=r(d[10])}),"35567a",["45f788","ba7a76","07aa1f","dcc72a","2c6bf9","af724a","068775","014366","379789","ed263e","fc4d8f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n={}){const{loading:s,data:l}=(0,o().useMinimalistClientSideQuery)(u.default,{...n}),v=(0,t.useMemo)((()=>(l?.presentation?.naviAnnouncements||[]).map((({id:n,...t})=>'CrossDeviceNaviAnnouncementId'===n.__typename?new c.default({...t,id:n.crossDeviceAnnouncementId,discriminator:n.discriminator||void 0}):new c.default.SingleDevice({...t,id:n.localDeviceAnnouncementId})))),[l]);return{loading:s,data:l,announcements:v}};var t=r(d[1]);function o(){const n=r(d[2]);return o=function(){return n},n}var u=n(r(d[3])),c=n(r(d[4]))}),"379789",["ba7a76","07aa1f","068abc","c6ac87","f4362a"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t(r(d[1]));const o={document:void 0,getDocument:()=>r(d[3])(d[2]).then(n.default).then((t=>t.default)),name:'RecordNaviAnnouncementView',type:'mutation',operationId:'aade9d0a651edc2144a18d8d72447202b083786fbd97021889e097e13834b55e'};e.default=o}),"386890",["ba7a76","45f788","5c48ba","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.useCanvasAnnouncementInProductPreview=void 0;var t=r(d[1]),u=n(r(d[2])),s=n(r(d[3])),c=r(d[4]),o=r(d[5]),v=r(d[6]);e.useCanvasAnnouncementInProductPreview=()=>{const n=(0,u.default)(),l=(0,v.createPreviewConfig)(n),A=(0,c.isCanvasAnnouncementEnabled)()&&null!=l,{loading:f,data:C,error:P}=(0,o.useCanvasAnnouncementPreview)({variables:l??{},skip:!A}),E=C?.presentation?.canvasAnnouncement?.announcements?.[0]?.content,_=(0,s.default)(c.CANVAS_PREVIEW_ANNOUNCEMENT_ID);(0,t.useEffect)((()=>{(0,c.isCanvasAnnouncementEnabled)()&&(f||(!P&&A&&E?_.ready(E):_.cancel()))}),[f,P,E,_,A])}}),"45b5b2",["ba7a76","07aa1f","a7c4ef","c7e43f","0dd5ca","653072","4a39c9"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.useIsCanvasPreviewEnabled=e.createPreviewConfig=void 0;var t=n(r(d[1])),c=r(d[2]);const o=n=>n.canvas_content_id?{contentId:n.canvas_content_id,contentVersionId:n.canvas_content_version_id??null,megaSectionId:n.canvas_mega_section_id,microSectionId:n.canvas_micro_section_id,hydrationMode:'PRODUCTION',page:'TODAY_TAB'}:null;e.createPreviewConfig=o;e.useIsCanvasPreviewEnabled=()=>{const n=(0,t.default)();return(0,c.isCanvasAnnouncementEnabled)()&&null!=o(n)}}),"4a39c9",["ba7a76","a7c4ef","0dd5ca"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AppTarget",{enumerable:!0,get:function(){return u.AppTarget}}),Object.defineProperty(e,"NaviAnnouncement",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"NaviAnnouncementPages",{enumerable:!0,get:function(){return u.NaviAnnouncementPages}}),Object.defineProperty(e,"NaviPresenter",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(e,"PresentationResult",{enumerable:!0,get:function(){return u.PresentationResult}}),Object.defineProperty(e,"Priority",{enumerable:!0,get:function(){return u.Priority}}),Object.defineProperty(e,"SingleDeviceAnnouncement",{enumerable:!0,get:function(){return l.SingleDeviceAnnouncement}}),Object.defineProperty(e,"useExistingScope",{enumerable:!0,get:function(){return b.useExistingScope}}),Object.defineProperty(e,"useFutureAnnouncement",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"usePage",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"usePresenter",{enumerable:!0,get:function(){return f.usePresenter}}),Object.defineProperty(e,"useScope",{enumerable:!0,get:function(){return b.default}});var u=r(d[2]),o=(t(r(d[3])),n(r(d[4]))),c=n(r(d[5])),f=r(d[6]),b=t(r(d[7])),l=t(r(d[8])),P=n(r(d[9]));n(r(d[10])),r(d[11])}),"502fde",["ba7a76","45f788","af724a","068775","c7e43f","834679","708bea","014366","f4362a","cee790","fd91b8","fc4d8f"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t.filter((o=>!o.presentationResult)).filter((n=>n.showState!==o.AnnouncementShowState.DROP)).map(((o,n)=>[o,n])).sort(n).map((([o])=>o))};var o=r(d[0]);function n([{choreographyInfo:{priority:n,groupInfo:t}},u],[{choreographyInfo:{priority:p,groupInfo:f}},c]){const s=o.PRIORITY_RANK.indexOf(n),l=o.PRIORITY_RANK.indexOf(p);return s!==l?s-l:t&&!f?-1:!t&&f?1:t&&f?t.groupName!==f.groupName?(I=t.groupName,O=f.groupName,I?O?I.localeCompare(O,'en'):-1:1):t.sequenceOrder-f.sequenceOrder:u-c;var I,O}}),"53350f",["af724a"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.createPreviewAnnouncement=void 0;var t=r(d[1]),o=n(r(d[2])),c=r(d[3]),p=r(d[4]);const s=999,l=3e5;e.createPreviewAnnouncement=()=>new o.default.SingleDevice({id:p.CANVAS_PREVIEW_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new c.CappedImpressionWithExpirationPolicy({maxCap:s,impressionExpirationUtcDateTime:`${Date.now()+l}`}),choreographyInfo:{priority:t.Priority.POISON_PILL}})}),"5b215d",["ba7a76","af724a","068775","fc4d8f","0dd5ca"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,_.default)(c.GLOBAL_SCOPE_ID),{loading:t,announcements:S}=(0,h.default)({variables:{appTarget:c.AppTarget.HOST},skip:!u.Flagger.isTrebuchetLaunched((0,o.default)('web.navi_server_announcements.host'))}),I=(0,b.useIsCanvasPreviewEnabled)();return(0,s.useEffect)((()=>{!t&&S.length&&n.scheduleAnnouncements(S),u.Flagger.isTrebuchetLaunched((0,o.default)('navi_migration.host_terms_of_service.launch.web'))&&(n.registerPresenter(T.default),n.scheduleAnnouncement(new f.default.SingleDevice({id:T.HOST_TOS_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new N.AlwaysShowPolicy,choreographyInfo:{priority:c.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:1}}}))),(0,w.isUserConsentEnabled)()&&(n.registerPresenter(w.default),n.scheduleAnnouncement(new f.default.SingleDevice({id:w.USER_CONSENT_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new N.AlwaysShowPolicy,choreographyInfo:{priority:c.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:2}}}))),(0,y.isGlobalBannerEnabled)()&&n.registerPresenter(y.default),(0,A.isTaskManagementFooterEnabled)()&&n.registerPresenter(A.default),n.registerPresenter(E.default),I&&n.scheduleAnnouncement((0,P.createPreviewAnnouncement)()),t||n.startPresentation()}),[t,S]),(0,O.jsxs)(l.default,{children:[(0,O.jsx)(v.default,{}),(0,O.jsx)(p.default,{})]})};var s=t(r(d[2])),l=n(r(d[3])),u=r(d[4]),o=n(r(d[5])),c=r(d[6]),f=n(r(d[7])),_=n(r(d[8])),h=n(r(d[9])),p=n(r(d[10])),E=n(r(d[11])),P=r(d[12]),b=r(d[13]),v=n(r(d[14])),y=t(r(d[15])),A=t(r(d[16])),T=t(r(d[17])),w=t(r(d[18])),N=r(d[19]),O=r(d[20])}),"620971",["ba7a76","45f788","07aa1f","d368ab","dcc72a","2c6bf9","af724a","068775","014366","379789","dd7619","0dd5ca","5b215d","4a39c9","7a7dcb","c57e59","eb25b6","20f028","ed263e","fc4d8f","b8c07d"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isReservationTaskMenuBundledErfEnabled=_,e.isTaskSystemEnabled=function({flagger:t,shouldLog:u=!0}){return t.isTrebuchetLaunched((0,s.default)('web.task_system.enabled'))&&_({flagger:t,shouldLog:u})};var u=t(r(d[1])),s=t(r(d[2]));function _({flagger:t,shouldLog:_=!0}){if(t.isTrebuchetLaunched((0,s.default)('m13_host_launch'))){if(t.isTrebuchetLaunched((0,s.default)('user_is_es_host_as_of_m13')))return!0;return'treatment'===t.findTreatment((0,u.default)('m13_launch_host_reservation_taskcards_menu_bundled_child_web'),{log:_})}return t.isTrebuchetLaunched((0,s.default)('user_is_es_host_as_of_m13'))||t.findTreatment((0,u.default)('m13_launch_host_reservation_taskcards_menu_bundled_aa_child_web'),{log:_}),!1}}),"63aa08",["ba7a76","4d3544","2c6bf9"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;function t(){const n=r(d[1]);return t=function(){return n},n}Object.defineProperty(e,"__esModule",{value:!0}),e.useCanvasAnnouncementPreview=void 0;var u=n(r(d[2]));e.useCanvasAnnouncementPreview=({variables:n,skip:s})=>{const{data:o,loading:c,error:l,refetch:v}=(0,t().useMinimalistClientSideQuery)(u.default,{variables:n,skip:s});return{data:o,error:l,loading:c,refetch:v}}}),"653072",["ba7a76","068abc","f02099"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.naviAppTargets=void 0;var t=r(d[0]);const E=e.naviAppTargets={EXPERIENCE_HOST:'EXPERIENCE_HOST',GUEST:'GUEST',HOST:'HOST'};(0,t.getEnumObjectValidator)()(E)}),"6a6f1f",["d416e6"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.usePresenter=function(s){const{currentAnnouncement:o,markAsViewed:f,markAsComplete:l}=(0,u.useNaviState)(),A=(0,n.useRef)(o),[R,S]=(0,n.useState)((()=>c(s,o))),k=(0,n.useRef)(!1),_=(0,n.useRef)(!1);(0,n.useEffect)((()=>{c(s,o)?(S(!0),A.current=o):o&&o===A.current||(S(!1),k.current=!1,_.current=!1)}),[o]);const p=()=>{c(s,o)&&!k.current&&A.current&&A.current===o&&(k.current=!0,f(A.current))},v=(n=t.PresentationResult.DISMISSED)=>{c(s,o)&&!_.current&&A.current&&A.current===o&&(_.current=!0,l(A.current,n))};return(0,n.useMemo)((()=>({shouldRender:R,content:A.current?.content,markAsViewed:p,markAsComplete:v})),[R])};var n=r(d[0]),t=r(d[1]),u=r(d[2]);function c(n,t){return!!t&&n.canHandleAnnouncement(t.id,t.content)}}),"708bea",["07aa1f","af724a","9836eb"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n){const f=(0,l.default)(),R=(0,t.useRef)(new Map),y=(n,t)=>{R.current.set(n,{id:n,presenters:new Set,announcements:new Map,dependencies:new Set(t),isReady:!1})},v=(0,t.useRef)(new Map),w=n=>{const t='string'==typeof n?n:(0,s.getAnnouncementId)(n);return v.current.get(t)||(new o.default).resolve(!1)},A=n=>R.current.get(n),S=()=>[...R.current.values()],$=(n,t)=>{const c=A(n);if(!c)return;const s=new Set(t);(0,u.isEqualSet)(s,c.dependencies)||(c.dependencies=s,f((()=>[`Updating scope "${n}" dependencies:`,t])))},D=n=>{const t=A(n);t&&!t?.isReady&&(t.isReady=!0,f((()=>`Marking scope ${n} as ready`)))},h=()=>p(c.GLOBAL_SCOPE_ID,R.current),E=n=>{const t=A(n);t&&(f((()=>`Removing scope ${n}`)),R.current.delete(n),t.announcements.forEach((n=>{n.clearTimeout(),v.current.delete(n.announcement.id)})))},T=n=>{const t=A(n);t&&(f((()=>`Resetting scope ${n}`)),t.isReady=!1,t.announcements.forEach((n=>{n.clearTimeout(),v.current.delete(n.announcement.id)})),t.announcements.clear(),t.presenters.clear())},M=(n,t)=>{A(t)?.presenters.has(n)||(f((()=>`Registering presenter: "${n}" -> ${t}`)),A(t)?.presenters.add(n))},_=(n,t)=>{A(t)?.presenters.has(n)&&(f((()=>`Removing presenter: "${n}" -> ${t}`)),A(t)?.presenters.delete(n))},P=()=>S().filter((n=>n.isReady)).filter((n=>p(n.id,R.current))).map((n=>[...n.presenters])).flat(),U=(n,t)=>{const c=(0,s.coerceToFutureAnnouncement)(n),{announcement:u}=c,l=A(t);if(!l||l.announcements.has(u.id))return!1;if(u.campaignEndUtcDateTime&&new Date>new Date(u.campaignEndUtcDateTime))return f((()=>[`Skipping "${u.id}" due to expiration`,u])),w(u.id).resolve(!1),!1;l.announcements.set(u.id,c),f((()=>[`Scheduling announcement ${u.id} to scope ${t}`,u,l.announcements]));const p=new o.default;return v.current.set(u.id,p),!0},I=(n,t)=>{const c=A(t);c&&(c.announcements.get(n)?.clearTimeout(),c.announcements.delete(n),v.current.delete(n))},O=()=>S().filter((n=>n.isReady)).filter((n=>p(n.id,R.current))).map((n=>[...n.announcements.values()])).flat().filter((t=>{const c=t.announcement?.filterInfo?.pages;return!c?.length||n.current&&c.includes(n.current)})),b=()=>new Set(O().map((n=>n.announcement.id))),k=()=>{const n=O(),t=P();return n.filter((({announcement:n})=>!!t.find((t=>t.canHandleAnnouncement(n.id,n.content))))).filter((({announcement:n})=>!n.campaignEndUtcDateTime||new Date(n.campaignEndUtcDateTime)>new Date))},G=n=>S().map((n=>[...n.announcements.values()])).flat().find((t=>t.announcement.id===n));return(0,t.useMemo)((()=>({add:y,get:A,all:S,updateDependencies:$,remove:E,reset:T,ready:D,isGlobalReady:h,ref:R,registerPresenter:M,removePresenter:_,getReadyPresenters:P,addAnnouncement:U,removeAnnouncement:I,getReadyAnnouncements:O,getScheduledAnnouncementIds:b,getSupportedAnnouncements:k,findAnnouncement:G,getAnnouncementResult:w})),[])};var t=r(d[1]),c=r(d[2]),s=r(d[3]),u=r(d[4]),o=n(r(d[5])),l=n(r(d[6]));function p(n,t,c=new Set){const s=t.get(n);return!(!s||!s.isReady)&&(!!c.has(n)||(c.add(n),[...s.dependencies].every((n=>p(n,t,c)))))}}),"762889",["ba7a76","07aa1f","af724a","068775","1a5f67","0af475","c809cd"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default,t=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const n=(0,f.default)(o.GLOBAL_SCOPE_ID),{loading:t,announcements:h}=(0,p.default)({variables:{appTarget:o.AppTarget.GUEST},skip:!l.Flagger.isTrebuchetLaunched((0,s.default)('web.navi_server_announcements.guest'))});return(0,u.useEffect)((()=>{!t&&h.length&&n.scheduleAnnouncements(h),(0,_.isUserConsentEnabled)()&&(n.registerPresenter(_.default),n.scheduleAnnouncement(new c.default.SingleDevice({id:_.USER_CONSENT_ANNOUNCEMENT_ID,campaignEndUtcDateTime:null,impressionPolicy:new E.AlwaysShowPolicy,choreographyInfo:{priority:o.Priority.LEGAL,groupInfo:{groupName:'aaa_global',sequenceOrder:1}}}))),t||n.startPresentation()}),[t,h]),null};var u=r(d[2]),l=r(d[3]),s=t(r(d[4])),o=r(d[5]),c=t(r(d[6])),f=t(r(d[7])),p=t(r(d[8])),_=n(r(d[9])),E=r(d[10])}),"77b657",["45f788","ba7a76","07aa1f","dcc72a","2c6bf9","af724a","068775","014366","379789","ed263e","fc4d8f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,l=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){const{shouldRender:t}=(0,c.usePresenter)(o.default);return t?(0,h.jsx)(s.default,{children:(0,h.jsx)(n.default,{loader:j,renderPlaceholder:n.renderNull})}):null};var u=l(r(d[0])),n=(l(r(d[2])),t(r(d[3]))),f=l(r(d[4])),s=l(r(d[5])),c=r(d[6]),o=l(r(d[7])),h=r(d[8]);const j=Object.assign((0,f.default)((()=>r(d[10])(d[9]).then(u.default))),{prefetch:()=>r(d[10]).prefetch(d[9])})}),"7a7dcb",["45f788","ba7a76","07aa1f","b96ee5","b4385c","d368ab","708bea","c57e59","b8c07d","40415e","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.useNaviInternalContext=function(){return(0,n.useContext)(o)};var n=r(d[0]);function t(){}const o=(0,n.createContext)({addScope:t,removeScope:t,resetScope:t,updateScopeDependencies:t,registerPresenter:t,removePresenter:t,scheduleAnnouncement:()=>Promise.resolve(!1),scheduleAnnouncements:()=>Promise.all([]),removeAnnouncement:t,findAnnouncement:()=>{},startPresentation:t,onPageEnter:t,onPageExit:t,resetPage:t});o.displayName='NaviInternalApiContext';e.default=o}),"7b3437",["07aa1f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,s){const f=(0,u.useNaviInternalContext)(),c=(0,o.default)(t,s);return(0,n.useEffect)((()=>(f.onPageEnter(t),()=>f.onPageExit(t))),[t]),(0,n.useMemo)((()=>({...c,reset:()=>f.resetPage(t),remove:()=>f.onPageExit(t)})),[t])};var n=r(d[1]),u=r(d[2]),o=t(r(d[3]))}),"834679",["ba7a76","07aa1f","7b3437","014366"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NaviStateContext=void 0,e.useNaviState=function(){return(0,t.useContext)(n)};var t=r(d[0]);const n=e.NaviStateContext=(0,t.createContext)({currentAnnouncement:null,markAsViewed:()=>{},markAsComplete:()=>{}});n.displayName='NaviStateContext'}),"9836eb",["07aa1f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t(r(d[1]));const f={document:void 0,getDocument:()=>r(d[3])(d[2]).then(n.default).then((t=>t.default)),name:'AnnouncementImpressionInfo',type:'query',operationId:'1fc7ebbfcc39bd532a9e5d40a585a65e09b7b95308f2a7e8f7d3bac6db63df43'};e.default=f}),"a6a446",["ba7a76","45f788","a750a0","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.jitneyId=function({id:t,discriminator:n},o){const s=n?`${t}.${n}`:t;if(o)return`${s.toLowerCase()}.${o.toLowerCase()}_navi`;return`${s.toLowerCase()}_navi`}}),"a8aa8f",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Priority=e.PresentationResult=e.PresentationRestrictions=e.PRIORITY_RANK=e.OrchestrationState=e.NoConsentBehavior=e.NaviAnnouncementPages=e.GLOBAL_SCOPE_ID=e.AppTarget=e.AnnouncementShowState=void 0;var I=r(d[0]),E=r(d[1]);e.AnnouncementShowState=(function(I){return I.SHOW="SHOW",I.DROP="DROP",I})({}),e.PresentationResult=(function(I){return I.DISCARDED="DISCARDED",I.DISMISSED="DISMISSED",I.ACTIONED="ACTIONED",I})({}),e.PresentationRestrictions=(function(I){return I.SHOW_ALWAYS="SHOW_ALWAYS",I.SHOW_ONLY_IF_FIRST_IN_PAGE="SHOW_ONLY_IF_FIRST_IN_PAGE",I.SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS="SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS",I})({});let O=e.Priority=(function(I){return I.POISON_PILL="POISON_PILL",I.CRITICAL="POISON_PILL",I.LEGAL="LEGAL",I.HIGH="LEGAL",I.INTERACTIVE="INTERACTIVE",I.TIME_SENSITIVE_REQUIRED_ACTION="TIME_SENSITIVE_REQUIRED_ACTION",I.REGULAR="TIME_SENSITIVE_REQUIRED_ACTION",I.MARKETING_EDUCATIONAL="MARKETING_EDUCATIONAL",I.LOW="MARKETING_EDUCATIONAL",I.CELEBRATION_RECOGNITION="CELEBRATION_RECOGNITION",I.VERY_LOW="CELEBRATION_RECOGNITION",I})({});e.PRIORITY_RANK=Object.freeze([O.POISON_PILL,O.LEGAL,O.INTERACTIVE,O.TIME_SENSITIVE_REQUIRED_ACTION,O.MARKETING_EDUCATIONAL,O.CELEBRATION_RECOGNITION]);e.OrchestrationState=(function(I){return I[I.SETUP=0]="SETUP",I[I.ACTIVE=1]="ACTIVE",I[I.WAITING=2]="WAITING",I})({});e.NaviAnnouncementPages=I.naviAnnouncementPages,e.GLOBAL_SCOPE_ID='GLOBAL_SCOPE_ID',e.AppTarget=E.naviAppTargets;e.NoConsentBehavior=(function(I){return I.SHOW="SHOW",I.DROP="DROP",I})({})}),"af724a",["fd3d5f","6a6f1f"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isGlobalBannerEnabled=e.default=void 0;var l=r(d[1]),t=n(r(d[2])),o=n(r(d[3]));e.isGlobalBannerEnabled=()=>l.Flagger.isTrebuchetLaunched((0,t.default)('navi_migration.host_global_banner.launch.web'));const u=new o.default(((n,l)=>"HOST_GLOBAL_BANNER"===n||'HostGlobalBannerContent'===l?.__typename));e.default=u}),"c57e59",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(r(d[1]));const t={document:void 0,getDocument:()=>r(d[3])(d[2]).then(o.default).then((n=>n.default)),name:'NaviServerAnnouncementsQuery',type:'query',operationId:'4eb801c0a84e928ee6f5625a5841dfb9f79dfa9f124c8c747553dd8a0c2830f8',normalizedItemsLocators:[{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['RequiredTask'],responseKey:'action'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['RequiredTask'],responseKey:'listing'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'topLevelTask'},{typeCondition:['RequiredTask'],responseKey:'action'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'topLevelTask'},{typeCondition:['RequiredTask'],responseKey:'listing'}]},{keyPath:'id',itemsLocation:[{typeCondition:['Query'],responseKey:'presentation'},{typeCondition:['RootPresentationContainer'],responseKey:'naviAnnouncements'},{typeCondition:['NaviAnnouncement'],responseKey:'content'},{typeCondition:['TaskManagementFooter'],responseKey:'task'},{typeCondition:['WaitingRoom'],responseKey:'actions'}]}]};e.default=t}),"c6ac87",["ba7a76","45f788","3f7b6c","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";var n=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(n){const s=(0,c.default)('FutureAnnouncement'),{findAnnouncement:l}=(0,u.useNaviInternalContext)(),f=l(n),y=o((t=>{s((()=>`FutureAnnouncement(${n}).ready()`)),f?.ready(t)})),v=o((()=>{s((()=>`FutureAnnouncement(${n}).cancel()`)),f?.cancel()}));return(0,t.useMemo)((()=>({exists:!!f,announcement:f?.announcement,ready:t=>{f?y(t):s((()=>`"${n}" does not exist yet`))},cancel:()=>{f?v():s((()=>`"${n}" does not exist yet`))}})),[f,y,v])};var t=r(d[1]),u=r(d[2]),c=n(r(d[3]));function o(n){const u=(0,t.useRef)(!1);return(0,t.useCallback)((t=>{if(!u.current)return u.current=!0,n(t)}),[n])}}),"c7e43f",["ba7a76","07aa1f","7b3437","c809cd"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t="Navi"){return(0,u.useDebugLogger)(t)};var u=r(d[0])}),"c809cd",["f8ea9a"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=class{constructor(t){this.matcher=void 0,this.matcher=t}canHandleAnnouncement(t,c){if('string'==typeof this.matcher)return t===this.matcher;try{return this.matcher(t,c)}catch(t){return!1}}toString(){return`${this.matcher}`}}}),"cee790",[]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){(0,h.useCanvasAnnouncementInProductPreview)();const{shouldRender:t}=(0,f.usePresenter)(o.default);return t?(0,v.jsx)(c.default,{children:(0,v.jsx)(l.default,{loader:P,renderPlaceholder:l.renderNull})}):null};var u=n(r(d[0])),l=(n(r(d[2])),t(r(d[3]))),s=n(r(d[4])),c=n(r(d[5])),f=r(d[6]),o=n(r(d[7])),h=r(d[8]),v=r(d[9]);const P=Object.assign((0,s.default)((()=>r(d[11])(d[10]).then(u.default))),{prefetch:()=>r(d[11]).prefetch(d[10])})}),"dd7619",["45f788","ba7a76","07aa1f","b96ee5","b4385c","d368ab","708bea","0dd5ca","45b5b2","b8c07d","1c0f93","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isTaskManagementFooterEnabled=e.default=void 0;var n=r(d[1]),l=r(d[2]),s=t(r(d[3]));e.isTaskManagementFooterEnabled=()=>(0,l.isTaskSystemEnabled)({flagger:n.Flagger});const o=new s.default('HOST_TASK_MANAGER');e.default=o}),"eb25b6",["ba7a76","dcc72a","63aa08","cee790"]);
__d((function(g,r,i,a,m,e,d){"use strict";var N=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.isUserConsentEnabled=e.default=e.USER_CONSENT_ANNOUNCEMENT_ID=void 0;var n=r(d[1]),t=N(r(d[2])),_=N(r(d[3]));e.isUserConsentEnabled=()=>n.Flagger.isTrebuchetLaunched((0,t.default)('navi_migration.consento_modals.launch.web'));const E=e.USER_CONSENT_ANNOUNCEMENT_ID='USER_CONSENT_ANNOUNCEMENT_ID',s=new _.default(E);e.default=s}),"ed263e",["ba7a76","dcc72a","2c6bf9","cee790"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=t(r(d[1]));const u={document:void 0,getDocument:()=>r(d[3])(d[2]).then(n.default).then((t=>t.default)),name:'CanvasAnnouncementOperation',type:'query',operationId:'b57e39c64a6da107f330c8ce32ed01feb22b6ff91297c1b7b81cfb820aaa68b9'};e.default=u}),"f02099",["ba7a76","45f788","0a69ae","057569"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.SingleDeviceAnnouncement=void 0;var t=r(d[0]);class o{constructor({id:o,discriminator:n,campaignEndUtcDateTime:s,choreographyInfo:h,content:c,filterInfo:p,impressionPolicy:v,noConsentBehavior:l,presentationResult:f,showState:y}){this.id=void 0,this.discriminator=void 0,this.campaignEndUtcDateTime=void 0,this.choreographyInfo=void 0,this.content=void 0,this.filterInfo=void 0,this.impressionPolicy=void 0,this.noConsentBehavior=void 0,this.presentationResult=void 0,this.showState=void 0,this.id=o,this.discriminator=n,this.campaignEndUtcDateTime=s,this.choreographyInfo=h,this.content=c,this.filterInfo=p,this.impressionPolicy=v,this.presentationResult=f,this.showState=y,this.choreographyInfo.presentationRestriction||(this.choreographyInfo.presentationRestriction=this.choreographyInfo.priority===t.Priority.POISON_PILL||this.choreographyInfo.priority===t.Priority.LEGAL||this.choreographyInfo.priority===t.Priority.INTERACTIVE?t.PresentationRestrictions.SHOW_ALWAYS:t.PresentationRestrictions.SHOW_ONLY_IF_FIRST_IN_PAGE),this.noConsentBehavior=l||t.NoConsentBehavior.DROP}}class n extends o{constructor(t){super(t),this.id=void 0,this.id=t.id}}e.SingleDeviceAnnouncement=n;class s extends o{constructor(t){super(t),this.id=void 0,this.id=t.id}}e.default=s,s.SingleDevice=n}),"f4362a",["af724a"]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CappedImpressionWithExpirationPolicy=e.CappedImpressionPolicy=e.AlwaysShowPolicy=void 0;e.AlwaysShowPolicy=class{constructor({forceDiscard:o}={}){this.forceDiscard=void 0,this.forceShow=void 0,this.forceDiscard=o,this.forceShow=!0}};e.CappedImpressionPolicy=class{constructor({forceDiscard:o,forceShow:s,maxCap:c}){this.forceDiscard=void 0,this.forceShow=void 0,this.maxCap=void 0,this.forceDiscard=o,this.forceShow=s,this.maxCap=c}};e.CappedImpressionWithExpirationPolicy=class{constructor({forceDiscard:o,forceShow:s,maxCap:c,impressionExpirationUtcDateTime:t}){this.forceDiscard=void 0,this.forceShow=void 0,this.maxCap=void 0,this.impressionExpirationUtcDateTime=void 0,this.forceDiscard=o,this.forceShow=s,this.maxCap=c,this.impressionExpirationUtcDateTime=t}}}),"fc4d8f",[]);
__d((function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.naviAnnouncementPages=void 0;var E=r(d[0]);const S=e.naviAnnouncementPages={CHECK_IN_METHOD_MANAGEMENT:'CHECK_IN_METHOD_MANAGEMENT',EARNINGS:'EARNINGS',EXPERIENCES_CALENDAR:'EXPERIENCES_CALENDAR',EXPERIENCES_DASHBOARD:'EXPERIENCES_DASHBOARD',EXPERIENCES_INSIGHTS:'EXPERIENCES_INSIGHTS',EXPERIENCES_PROFILE:'EXPERIENCES_PROFILE',GUEST_HOMEPAGE:'GUEST_HOMEPAGE',GUEST_PROFILE:'GUEST_PROFILE',HOST_RESERVATION_DETAILS:'HOST_RESERVATION_DETAILS',INBOX:'INBOX',INBOX_THREAD:'INBOX_THREAD',LOL:'LOL',MANAGE_QUICK_REPLIES:'MANAGE_QUICK_REPLIES',QUICK_REPLIES_EDITOR:'QUICK_REPLIES_EDITOR',RESERVATIONS_TAB:'RESERVATIONS_TAB',SEARCH_INPUT:'SEARCH_INPUT',SEARCH_RESULT:'SEARCH_RESULT',STAYS_CALENDAR:'STAYS_CALENDAR',STAYS_PROFILE:'STAYS_PROFILE',TODAY_TAB:'TODAY_TAB',TRIPS:'TRIPS',USER_PROFILE:'USER_PROFILE',WISHLISTS:'WISHLISTS',WISHLIST_DETAILS:'WISHLIST_DETAILS'};(0,E.getEnumObjectValidator)()(S)}),"fd3d5f",["d416e6"]);
__d((function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,n=r(d[1]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function({children:t,app:n}){const k=(0,P.default)(),[N,w]=(0,o.useState)(null),L=(0,p.default)(N),W=(0,o.useRef)(R.OrchestrationState.SETUP),G=(0,o.useRef)(null),{getMatchedRoute:x}=(0,h.useAppRoutes)(),D=(0,v.default)(G),F=(0,_.default)(),j=(0,o.useRef)([]),H=(0,o.useCallback)((t=>t.choreographyInfo.presentationRestriction===R.PresentationRestrictions.SHOW_ONLY_IF_FIRST_IN_PAGE&&j.current.length>0||!(t.choreographyInfo.presentationRestriction!==R.PresentationRestrictions.SHOW_ONLY_IF_FIRST_NON_SHOW_ALWAYS||!j.current.some((t=>t.choreographyInfo.presentationRestriction!==R.PresentationRestrictions.SHOW_ALWAYS)))),[]),U=(0,o.useCallback)((async t=>{for(const n of(0,C.default)(t)){const t=await F.shouldShowAnnouncement(n);if(n.showState=t,D.getScheduledAnnouncementIds().has(n.id))if(t!==R.AnnouncementShowState.DROP){if(t===R.AnnouncementShowState.SHOW){if(H(n)){k((()=>['Suppressing announcement due to presentation restrictions',n])),D.getAnnouncementResult(n.id).resolve(!1);continue}return n}}else D.getAnnouncementResult(n.id).resolve(!1);else k((()=>`Skipping announcement "${n.id}", no longer scheduled`)),D.getAnnouncementResult(n.id).resolve(!1)}}),[]),Y=(0,o.useRef)(new AbortController),M=(0,o.useCallback)((async({continuePresenting:t,overridePriorities:n}={continuePresenting:!1})=>{if(W.current===R.OrchestrationState.ACTIVE&&!t)return;W.current=R.OrchestrationState.ACTIVE,Y.current.abort(),Y.current=new AbortController;const{signal:o}=Y.current,s=D.getScheduledAnnouncementIds();k((()=>['Finding top announcement from:',s]));for(const t of n||R.PRIORITY_RANK){const n=D.getSupportedAnnouncements().filter((n=>n.announcement.choreographyInfo.priority===t));if(!n.length)continue;n.forEach((t=>t.startTimeout()));const s=await Promise.allSettled(n.map((t=>t.promise)));if(o.aborted)return;const u=s.filter((t=>'fulfilled'===t.status)).map((t=>t.value)),c=await U(u);if(o.aborted)return;if(c)return k((()=>[`Presenting announcement: ${c.id}`,c])),void w(c)}(0,b.isEqualSet)(s,D.getScheduledAnnouncementIds())?n?k((()=>'Ending presentation loop, nothing higher priority than current announcement')):(W.current=R.OrchestrationState.WAITING,k((()=>'Ending presentation loop, nothing to show, moving to WAITING state'))):M({continuePresenting:!0,overridePriorities:n})}),[]),$=(0,o.useCallback)(((t,n)=>{const o=D.addAnnouncement(t,n);return o&&F.startImpressionRequest(t),o&&D.get(n)?.isReady&&W.current===R.OrchestrationState.WAITING&&(k((()=>'New announcement scheduled during WAITING state, restarting presentation')),M()),D.getAnnouncementResult(t)}),[]),q=(0,o.useCallback)(((t,n)=>(t.filter((t=>D.addAnnouncement(t,n)))?.map((t=>F.startImpressionRequest(t))).length>0&&D.get(n)?.isReady&&W.current===R.OrchestrationState.WAITING&&(k((()=>'New announcements scheduled during WAITING state, restarting presentation')),M()),Promise.all(t.map((t=>D.getAnnouncementResult(t)))))),[]),V=(0,o.useCallback)((()=>L.current&&D.get(R.GLOBAL_SCOPE_ID)?.announcements.has(L.current.id)),[]),B=(0,o.useCallback)((t=>{if(D.get(t)?.isReady)return;if(D.ready(t),W.current===R.OrchestrationState.ACTIVE&&!V())return;if(!D.isGlobalReady())return void k((()=>['Scope dependencies not yet satisfied:',D.all()]));if(!L.current)return k((()=>'All scope dependencies satisfied, starting presentation')),void M();if(!c.Flagger.isTrebuchetLaunched((0,l.default)('navi.web.page_change_reorchestrate')))return;const{id:n,choreographyInfo:{priority:o}}=L.current,s=R.PRIORITY_RANK.slice(0,R.PRIORITY_RANK.indexOf(o));k((()=>`All scopes are ready, already presenting global announcement ${n}.Now checking for anything higher priority than ${o}`)),M({continuePresenting:!0,overridePriorities:s})}),[]),K=(0,o.useCallback)((t=>{G.current=t,D.get(R.GLOBAL_SCOPE_ID)?.dependencies.add(t),W.current===R.OrchestrationState.WAITING&&(k((()=>'Resetting orchestrator into SETUP (onPageEnter)')),W.current=R.OrchestrationState.SETUP)}),[]),J=(0,o.useCallback)((()=>{if(!V())return!1;const t=L.current?.filterInfo?.pages;if(!t||0===t?.length)return!0;if(G.current)return t?.includes(G.current);if(!G.current&&1===t?.length)return!1;let n;try{const t=x(window.location.pathname,{matchAll:!0}),o=(t||[])?.find((({match:t})=>t.isExact));n=o?.route?.options?.naviPage}catch(t){}return n&&t?.includes(n)}),[]),X=(0,o.useCallback)((()=>{Y.current.abort(),F.clearRequestCache(),J()||(w(null),L.current=null,j.current=[],W.current=R.OrchestrationState.SETUP,k((()=>'Resetting orchestrator into SETUP')))}),[]),z=(0,o.useCallback)((t=>{k((()=>'Exiting page')),D.get(R.GLOBAL_SCOPE_ID)?.dependencies.delete(t),D.remove(t),G.current=null,X()}),[]),Q=(0,o.useCallback)((t=>{k((()=>'Resetting page')),D.reset(t),X()}),[]),Z=(0,o.useMemo)((()=>({addScope:D.add,removeScope:D.remove,resetScope:D.reset,updateScopeDependencies:D.updateDependencies,registerPresenter:D.registerPresenter,removePresenter:D.removePresenter,scheduleAnnouncement:$,scheduleAnnouncements:q,removeAnnouncement:D.removeAnnouncement,findAnnouncement:D.findAnnouncement,startPresentation:B,onPageEnter:K,onPageExit:z,resetPage:Q})),[]),ee=(0,o.useCallback)((t=>{F.recordImpression(t)}),[]),te=(0,o.useCallback)(((t,n)=>{k((()=>`Marking ${t.id} as complete (${n})`)),t.presentationResult=n;const o=n!==R.PresentationResult.DISCARDED;o&&(j.current.push(t),f.default.logJitneyEvent({schema:u().UniversalComponentActionEvent,event_data:{logging_id:(0,E.jitneyId)(t,n),ancestor_logging_ids:[],ancestor_uuids:[],method:'dismissed',uuid:(0,s().v4)(),operation:9}})),w(null),D.getAnnouncementResult(t.id).resolve(o),W.current===R.OrchestrationState.ACTIVE&&queueMicrotask((()=>M({continuePresenting:!0})))}),[]),ne=(0,o.useMemo)((()=>({currentAnnouncement:N,markAsViewed:ee,markAsComplete:te})),[N]);return(0,y.jsx)(O.default.Provider,{value:Z,children:(0,y.jsxs)(T.NaviStateContext.Provider,{value:ne,children:[n===R.AppTarget.HOST&&c.Flagger.isTrebuchetLaunched((0,l.default)('navi_global_scope.host'))&&(0,y.jsx)(I.default,{}),n===R.AppTarget.GUEST&&c.Flagger.isTrebuchetLaunched((0,l.default)('navi_global_scope.guest'))&&(0,y.jsx)(S.default,{}),n===R.AppTarget.EXPERIENCE_HOST&&c.Flagger.isTrebuchetLaunched((0,l.default)('navi_global_scope.exp_host'))&&(0,y.jsx)(A.default,{}),t]})})};var o=n(r(d[2]));function s(){const t=r(d[3]);return s=function(){return t},t}function u(){const t=r(d[4]);return u=function(){return t},t}var c=r(d[5]),l=t(r(d[6])),h=r(d[7]),p=t(r(d[8])),f=t(r(d[9])),A=t(r(d[10])),S=t(r(d[11])),I=t(r(d[12])),R=r(d[13]),P=t(r(d[14])),_=t(r(d[15])),v=t(r(d[16])),O=t(r(d[17])),T=r(d[18]),b=r(d[19]),E=r(d[20]),C=t(r(d[21])),y=r(d[22])}),"fd91b8",["ba7a76","45f788","07aa1f","305dd5","59c871","dcc72a","2c6bf9","2c12de","d18042","c8b97a","35567a","77b657","620971","af724a","c809cd","2b4782","762889","7b3437","9836eb","1a5f67","a8aa8f","53350f","b8c07d"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/2627.7237316b71.js.map